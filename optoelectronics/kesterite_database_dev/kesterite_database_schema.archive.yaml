definitions:
  name: 'Kesterite Database Entry v0p4'
  sections:
    KesteriteSample:
      # Important: must inherit from both, ElnBaseSection and TableRow
      # `base_sections` are used to inherit from definitions alreadybin nomad. These base classes 
      # do some work in the backgroud, like parsing the values, making quantities serachable and copying
      # values to our `Results` section, where all the entries become interoperable.

      base_sections: 
        - nomad.datamodel.metainfo.eln.ElnBaseSection
        - nomad.parsing.tabular.TableRow
        - nomad.datamodel.metainfo.eln.SampleID
        - nomad.datamodel.data.EntryData
      # description: |
      #   This is an example description for Chemical.
      m_annotations:
        eln: 
          hide: ['name', 'lab_id', 'children', 'parents'] # We want to hide some quantities defined in ElnBaseSection in our forms.
          # description: |
          #           This is an entry describing one Kesterite sample. The information for the sample may be added gradually and editted or completed at a later point. 
      
      quantities:
        description:
          type: str
          m_annotations:
            tabular:
              name: Institutions and Comments
            eln:
              component: RichTextEditQuantity
        
        status:
          type:
            type_kind: Enum
            type_data:
              - planned
              - in preparation
              - fully prepared
              - published
          description: |
                        Current status of the sample.
          m_annotations:
            eln:
              component: RadioEnumEditQuantity
      
      sub_sections:
        sample_stack:
          section:
            base_sections:
              - nomad.datamodel.metainfo.eln.SolarCellDefinition
            m_annotations:
              eln: 
                hide: ['architecture', 'solar_cell_area']
            quantities:
              stack_sequence:
                type: str
                shape: ['*']
                description: |
                  The stack sequence describing the cell. This is a repeating cell - after entering one layer, a new field will open below to fill the next layer. Use the following formatting guidelines
                  - Start with the substrate and list the materials in each layer of the device
                  - If two materials, e.g. A and B, are mixed in one layer, list the materials in alphabetic order and separate them with semicolons, as in (A; B)
                  - The absorber layer is commonly stated with a generaic name as 'CZTSe', regardless of composition, mixtures, dimensionality etc. There are other fields to describe the absorber layer in depth.            
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - quartz
                        - SLG
                        - stainless steel foil
                        - NaF
                        - Mo
                        - MoS
                        - MoSe
                        - CZTS
                        - CZTSe
                        - CZTSSe
                        - CdS
                        - Au
                        - Ag


              # substrate_material:
              #   type: str
              #   m_annotations:
              #     eln:
              #       component: EnumEditQuantity
              #       props:
              #         suggestions:
              #           - quartz
              #           - SLG
              #           - stainless steel
                
              substrate_supplier:
                type: str
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - Saint Gobain
        
        sample_stack_alternative_representation:
          repeats: true
          section:

            quantities:
              material:
                type: str
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - quartz
                        - SLG
                        - stainless steel foil
                        - NaF
                        - Mo
                        - MoS
                        - MoSe
                        - CZTS
                        - CZTSe
                        - CZTSSe
                        - CdS
                        - Au
                        - Ag
              thickness:
                type: np.float64
                unit: nm
                m_annotations:
                  eln:
                    component: NumberEditQuantity
                    defaultDisplayUnit: "nm"
              origin_or_deposition_method:
                type: str
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - 'supplied by:'
                        - PVD / Co-Evaporation
                        - DC sputtering
                        - AC sputtering
                        - Solution based

              
              

        precursor_layer:
          repeats: true
          section:
            m_annotations:
              eln: 
                hide: ['layer_name', 'solar_cell_layer_type']
            quantities:
              precursor_deposition_method:
                type: str
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - PVD / Co-Evaporation
                        - DC sputtering
                        - AC sputtering
                        - Solution based
              chemical_formula:
                type: str
                description: |+
                  Chemical formula stating the absorber layer composition.
                  
                  Cu2Zn(Sn0.2Ga0.8)(S0.25Se0.75)4 will be recognise, but Cu2Zn(Sn,Ga)(S,Se)4 will not work out because of the commas.
                m_annotations:
                  eln:
                    component: StringEditQuantity
              Layer_thickness:
                type: np.float64
                unit: nm
                m_annotations:
                  eln:
                    component: NumberEditQuantity
                    defaultDisplayUnit: "nm"
              composition_quantification_method:
                type: str
                m_annotations:
                  eln:
                      component: EnumEditQuantity
                      props:
                        suggestions:
                          - Deposition Parameters
                          - XRF
                          - XPS
                          - EDX
                          - GDOES
                          - ICP-MS
                          - WDX
                          - RBS
        
        absorber_layer:
          section:
            # Below we inherit from 2 base sections. The Chemical base section adds the
            # base ELN quantities ['name', 'lab_id', 'description'] that we decide to hide 
            # and a quantity called 'chemical_formula'. 'chemical formula' is a quantity in which 
            # a valid chemical formula gets parsed to make the entry searchable by elements and different 
            # formulae represetantions. The rule here is to introduce formulas which are
            # valid for pymatgen.core.composition. For example, Cu2Zn(Sn0.2Ga0.8)(S0.25Se0.75)4 will
            # be recognise, but Cu2Zn(Sn,Ga)(S,Se)4 will not work out because of the commas.  
            base_sections: 
              - 'nomad.datamodel.metainfo.eln.Chemical'
              - 'nomad.datamodel.metainfo.eln.SolarCellLayer'
            m_annotations:
              eln: 
                hide: ['name', 'lab_id', 'description', 'layer_name', 'bandgap', 'solar_cell_layer_type']
            sub_sections:
              chalcogenization_details:
                section:
                  quantities:
                    type_of_setup:
                      description: |
                                    Type of machine in which the chalcogenization is conducted.
                      type:
                        type_kind: Enum
                        type_data:
                          - Tube furnace
                          - RTP
                          - dedicated vavacuum chamber
                          - other
                      m_annotations:
                        eln:
                          component: RadioEnumEditQuantity
                    recipient_material:
                      description: |
                                    Material of the recipient in which the chalcogenization is conducted.
                      type:
                        type_kind: Enum
                        type_data:
                          - Graphite
                          - Quartz
                      m_annotations:
                        eln:
                          component: RadioEnumEditQuantity
                    recipient_mass:
                      description: |
                                      Mass of the recipient in which the chalcogenization is conducted.
                      type: np.float64
                      unit: g
                      m_annotations:
                        eln:
                          component: NumberEditQuantity
                          defaultDisplayUnit: "g"
                    recipient_inner_volume:
                      description: |
                                      Volume of atmosphere/air inside the closed recipient with the sample placed inside.
                      type: np.float64
                      unit: cm^3
                      m_annotations:
                        eln:
                          component: NumberEditQuantity
                          defaultDisplayUnit: "cm^3"
                    recipient_closed_with_screws?:
                      description: |
                                    Was the lid of the recipient closed with bolts/screws?
                      type: bool
                      m_annotations:
                        eln:
                          component: BoolEditQuantity
                    selenium_mass:
                      description: |
                                      Ammount of selenium inserted into the recipient for chalcogenization.
                      type: np.float64
                      unit: g
                      m_annotations:
                        eln:
                          component: NumberEditQuantity
                          defaultDisplayUnit: "g"
                    tin_mass:
                      description: |
                                      Ammount of tin inserted into the recipient for chalcogenization.
                      type: np.float64
                      unit: g
                      m_annotations:
                        eln:
                          component: NumberEditQuantity
                          defaultDisplayUnit: "g"
                  sub_sections:
                    temperature_steps:
                      repeats: true
                      section:
                        quantities:
                          temperature:
                            description: |
                                            Final temperature of that step.
                            type: np.float64
                            unit: °C
                            m_annotations:
                              eln:
                                component: NumberEditQuantity
                                defaultDisplayUnit: "°C"
                          dwell_time:
                            description: |
                                            Time spent at the given temperature after reaching it.
                            type: np.float64
                            unit: s
                            m_annotations:
                              eln:
                                component: NumberEditQuantity
                                defaultDisplayUnit: "s"
                          temperature_ramp:
                            description: |
                                            Rate of temperature increase/decrease to reach the final temperature of this stage.
                            type: np.float64
                            unit: K/minute
                            m_annotations:
                              eln:
                                component: NumberEditQuantity
                                defaultDisplayUnit: "K/minute"
                          atmosphere:
                            type:
                              type_kind: Enum
                              type_data:
                                - N2
                                - Ar
                                - vacuum
                                - other
                            description: |
                                          Atmosphere in the recipient during this step.
                            m_annotations:
                              eln:
                                component: RadioEnumEditQuantity
                          pressure:
                            description: |
                                            Pressure in the recipient during this step.
                            type: np.float64
                            unit: hPa
                            m_annotations:
                              eln:
                                component: NumberEditQuantity
                                defaultDisplayUnit: "hPa"
            quantities:
              chemical_formula:
                type: str
                description: |+
                  Chemical formula stating the absorber layer composition.
                  
                  Cu2Zn(Sn0.2Ga0.8)(S0.25Se0.75)4 will be recognise, but Cu2Zn(Sn,Ga)(S,Se)4 will not work out because of the commas.
                m_annotations:
                  tabular:
                    name: Formula 
                  eln:
                    component: StringEditQuantity
              composition_quantification_method:
                type: str
                m_annotations:
                  eln:
                      component: EnumEditQuantity
                      props:
                        suggestions:
                          - Deposition Parameters
                          - XRF
                          - XPS
                          - EDX
                          - GDOES
                          - ICP-MS
                          - WDX
                          - RBS
        
        optoelectronic_properties:
          section:
            base_sections:
              - 'nomad.datamodel.metainfo.eln.SolarCellBaseSectionWithOptoelectronicProperties'
            quantities:
              bandgap_estimation_basis:
                type: str
                description: |
                        Measurement or technique used to determine the bandgap value.
                m_annotations:
                  tabular:
                    name: Device structure
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - Tauc plot
                        - EQE-derivative
              doping:
                type: np.float64
                unit: cm^-3
                # description: |
                #         Doping level.
                m_annotations:
                  eln:
                    component: NumberEditQuantity
                    defaultDisplayUnit: cm^-3
              doping_estimation_basis:
                type: str
                description: |
                        Measurement or technique used to determine the doping.
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - Capacitance-Voltage
                        - Hall effect
                        - Photohall effect
              lifetime:
                type: np.float64
                unit: s
                # description: |
                #         Lorem ipsum
                m_annotations:
                  eln:
                    component: NumberEditQuantity
                    defaultDisplayUnit: ns
              lifetime_estimation_basis:
                type: str
                description: |
                        Measurement or technique used to determine the lifetime.
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - TRPL
              PLQY:
                type: np.float64
                description: |
                        Photoluminescence Quantum Yield.
                m_annotations:
                  eln:
                    component: NumberEditQuantity
                    minValue: 0
                    maxValue: 1
              PLQY_estimation_basis:
                type: str
                description: |
                        Measurement or technique used to determine the photoluminescence quantum yield.
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - absolute calibrated PL
              QFLS:
                type: np.float64
                unit: eV
                description: |
                        Quasi Fermi Level Splitting.
                m_annotations:
                  eln:
                    component: NumberEditQuantity
                    defaultDisplayUnit: eV
              QFLS_estimation_basis:
                type: str
                description: |
                        Measurement or technique used to determine the quasi fermi level splitting.
                m_annotations:
                  eln:
                    component: EnumEditQuantity
                    props:
                      suggestions:
                        - absolute calibrated PLQY
                        - SPV
            sub_sections:
              EQE:
                section:
                  base_sections:
                    - nomad.datamodel.metainfo.eln.SolarCellEQE
                  m_annotations:
                    # We can use the eln annotations to put the section to the overview
                    # page, and hide unwanted inherited quantities.
                    eln:
                      overview: true
                    # Plots are shown in the eln. Currently we only support simple x,y
                    # line plots
                    plot:
                      title: Extenral quantum efficiency (EQE)
                      x: raw_wavelength_array
                      y: raw_eqe_array
        
        solar_cell_parameters:
          section:
            base_sections: 
              - nomad.datamodel.metainfo.eln.perovskite_solar_cell_database.Module
              - 'nomad.datamodel.metainfo.eln.SolarCellJVCurve'
              - nomad.datamodel.metainfo.eln.SolarCellDefinition
              - 'nomad.parsing.tabular.TableData'
            m_annotations:
              # We can use the eln annotations to put the section to the overview
              # page, and hide unwanted inherited quantities.
              eln:
                overview: true
                hide: ['area_total', 'area_effective', 'cell_name', 'potential_at_maximum_power_point', 'current_density_at_maximun_power_point', 'series_resistance', 'shunt_resistance', 'stack_sequence', 'architecture']
              # Plots are shown in the eln. Currently we only support simple x,y
              # line plots
              plot:
                title: J-V curve
                x: voltage
                y: current_density
            quantities:
              data_file:
                type: str
                description: |
                  A reference to an uploaded .csv produced by the PVD evaporation instruments
                  control software.
                m_annotations:
                  # The tabular_parser annotation, will treat the values of this
                  # quantity as files. It will try to interpret the files and fill
                  # quantities in this section (and sub_section) with the column
                  # data of .csv or .xlsx files.
                  tabular_parser:
                    # sep: '\t'
                    comment: '#'
                  browser:
                    adaptor: RawFileAdaptor  # Allows to navigate to files in the data browser
                  eln:
                    component: FileEditQuantity  # A form field that allows to drop and select files.
              current_density:
                type: np.float64
                shape: ['*']
                unit: mA/cm**2
                m_annotations:
                  # The tabular annotation defines a mapping to column headers used in
                  # tabular data files
                  tabular:
                    name: j_sc
              voltage:
                type: np.float64
                shape: ['*']
                unit: V
                m_annotations:
                  tabular:
                    name: Voltage
                  plot:
                    x: voltage
                    y: current_density
              open_circuit_voltage:
                type: np.float64
                unit: V
                m_annotations:
                  eln:
                    component: NumberEditQuantity
              short_circuit_current_density:
                type: np.float64
                unit: mA/cm**2
                m_annotations:
                  eln:
                    component: NumberEditQuantity          
              fill_factor:
                type: np.float64
                m_annotations:
                  eln:
                    component: NumberEditQuantity
              efficiency:
                type: np.float64
                m_annotations:
                  eln:
                    component: NumberEditQuantity
            # sub_sections:
            #   Module:
            #     section:
            #       base_sections:

        publication_reference:
          section:
            base_sections: 
              - 'nomad.datamodel.metainfo.eln.PublicationReference'
            quantities:
              DOI_number:
                type: str
                m_annotations:
                  tabular:
                    name: doi
                  eln:
                    component: StringEditQuantity
